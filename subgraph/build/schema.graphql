# Pumasi - Decentralized Freelance Marketplace Schema

type Job @entity {
  id: ID! # jobId
  client: User!
  freelancer: User
  budget: BigInt!
  deadline: BigInt!
  status: JobStatus!
  metadataURI: String!
  createdAt: BigInt!
  completedAt: BigInt
  applications: [Application!]! @derivedFrom(field: "job")
  milestones: [Milestone!]! @derivedFrom(field: "job")
  reviews: [Review!]! @derivedFrom(field: "job")
  dispute: Dispute @derivedFrom(field: "job")
}

type User @entity {
  id: ID! # wallet address
  # Profile metadata (from ProfileRegistry)
  profileURI: String
  profileCreatedAt: BigInt
  profileUpdatedAt: BigInt
  # Job relationships
  jobsAsClient: [Job!]! @derivedFrom(field: "client")
  jobsAsFreelancer: [Job!]! @derivedFrom(field: "freelancer")
  applications: [Application!]! @derivedFrom(field: "freelancer")
  reviewsGiven: [Review!]! @derivedFrom(field: "reviewer")
  reviewsReceived: [Review!]! @derivedFrom(field: "reviewee")
  # Stats
  averageRating: BigDecimal
  totalJobsCompleted: Int!
  totalEarnings: BigInt!
  # Arbitrator
  isArbitrator: Boolean!
  arbitratorStake: BigInt
}

type Application @entity {
  id: ID! # jobId-freelancerAddress
  job: Job!
  freelancer: User!
  status: ApplicationStatus!
  proposalURI: String!
  createdAt: BigInt!
}

type Milestone @entity {
  id: ID! # jobId-milestoneIndex
  job: Job!
  index: Int!
  amount: BigInt!
  deadline: BigInt!
  status: MilestoneStatus!
  metadataURI: String!
}

type Review @entity {
  id: ID! # jobId-reviewerAddress
  job: Job!
  reviewer: User!
  reviewee: User!
  rating: Int!
  commentURI: String!
  createdAt: BigInt!
}

type Dispute @entity {
  id: ID! # jobId
  job: Job!
  status: DisputeStatus!
  clientEvidenceURI: String
  freelancerEvidenceURI: String
  votes: [Vote!]! @derivedFrom(field: "dispute")
  resolvedAt: BigInt
  resolution: VoteDecision
}

type Vote @entity {
  id: ID! # disputeId-arbitratorAddress
  dispute: Dispute!
  arbitrator: User!
  decision: VoteDecision!
  rationaleURI: String!
}

# Enums
enum JobStatus {
  Open
  InProgress
  Delivered
  Completed
  Disputed
  Cancelled
}

enum ApplicationStatus {
  Pending
  Accepted
  Rejected
}

enum MilestoneStatus {
  Pending
  InProgress
  Delivered
  Approved
  Disputed
}

enum DisputeStatus {
  EvidencePhase
  VotingPhase
  Resolved
}

enum VoteDecision {
  FullToClient
  FullToFreelancer
  Split
}
